console.log("Error converting to encrypted format:", err);
            // Continue with plaintext version for now
          }
        }
      }

      // Initialize UI
      const queue = getQueue();
      document.getElementById('queueModeToggle').checked = queue.queueMode;
      updateQueueUI();
      
      // Add event delegation for retry buttons
      document.getElementById('batchResults').addEventListener('click', event => {
        if (event.target.classList.contains('retry-button')) {
          const url = event.target.getAttribute('data-url');
          if (url) {
            // Add back to queue
            const queue = getQueue();
            queue.articles.push({
              url: url,
              timestamp: new Date().toISOString()
            });
            saveQueue(queue);
            updateQueueUI();
            showStatus('Article added back to queue for retry', 'success');
            
            // Remove the error item
            const errorItem = event.target.closest('.error-item');
            if (errorItem) {
              errorItem.remove();
            }
          }
        }
      });
      
      // Check service worker status periodically
      setInterval(async () => {
        if (swReady) {
          try {
            await pingServiceWorker();
            // If ping successful, service worker is responsive
          } catch (error) {
            console.error('Service worker ping failed:', error);
            swReady = false;
            updateServiceWorkerStatus('error', 'Service Worker unresponsive');
          }
        } else {
          // Try to check if service worker has become ready
          try {
            await checkServiceWorkerStatus();
          } catch (error) {
            console.error('Service worker status check failed:', error);
          }
        }
      }, 30000); // Check every 30 seconds
    } else {
      updateServiceWorkerStatus('error', 'Not supported');
      showStatus('Service Worker not supported in your browser. Some features may not work.', 'error');
    }
  </script>
</body>
</html>